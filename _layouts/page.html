<!DOCTYPE html>
<html lang="en-US">
  <head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>{{site.title}}</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="{{site.title}}" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="https://iolfcv.github.io" />
<meta property="og:url" content="https://iolfcv.github.io" />
<meta property="og:site_name" content="{{site.title}}" />

<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
	apiKey: "AIzaSyD8xOcp25rWZaeEr56EAp7yyM_tFwmEUsI",
	authDomain: "iolfcv.firebaseapp.com",
	databaseURL: "https://iolfcv.firebaseio.com",
	projectId: "iolfcv",
	storageBucket: "iolfcv.appspot.com",
	messagingSenderId: "497271623628"
  };
  firebase.initializeApp(config);
</script>
  <script type="text/javascript">
	/**
	 * Function called when clicking the Login/Logout button.
	 */
	function toggleSignIn() {
		if (!firebase.auth().currentUser) {
			var provider = new firebase.auth.GithubAuthProvider();
			provider.addScope('repo');
			firebase.auth().signInWithRedirect(provider);

		} else {
			firebase.auth().signOut();
		}
		document.getElementById('sign-in').disabled = true;
		}
	/**
	 * initApp handles setting up UI event listeners and registering Firebase auth listeners:
	 *  - firebase.auth().onAuthStateChanged: This listener is called when the user is signed in or
	 *    out, and that is where we update the UI.
	 *  - firebase.auth().getRedirectResult(): This promise completes when the user gets back from
	 *    the auth redirect flow. It is where you can get the OAuth access token from the IDP.
	 */
	function initApp() {
		firebase.auth().getRedirectResult().then(function(result) {
			// The signed-in user info.
			var user = result.user;
		}).catch(function(error) {
			var errorCode = error.code;
			var errorMessage = error.message;
			var email = error.email;
			var credential = error.credential;
			if (errorCode === 'auth/account-exists-with-different-credential') {
				alert('You have already signed up with a different auth provider for that email.');
			} else {
			console.error(error);
			}
	  	});
		firebase.auth().onAuthStateChanged(function(user) {
			if (user) {
				// User is signed in.
				var displayName = user.displayName;
				var email = user.email;
				var emailVerified = user.emailVerified;
				var photoURL = user.photoURL;
				var isAnonymous = user.isAnonymous;
				var uid = user.uid;
				var providerData = user.providerData;
				console.log(email);
				document.getElementById('sign-in').textContent = 'Sign out';
				document.getElementById('name').style.visibility = "visible";
				document.getElementById('email').style.visibility = "visible";
				document.getElementById('emailInp').setAttribute('value', email);
				var ref = firebase.database().ref('users/' + user.uid);
				var affliationRef = ref.child('affliation');
				// console.log('hihi')
				affliationRef.once('value').then(function (snapshot) {
					if (snapshot.val() != null && snapshot.val().length > 0) {
						console.log(snapshot.val());
						document.getElementById('affliation').setAttribute('value', snapshot.val());
						document.getElementById('button').textContent = 'Change';

					} else {
						document.getElementById('aff').style.visibility = "visible";
						document.getElementById('link').style.visibility = "hidden";						

					}
				});
				var nameRef = ref.child('username');
				nameRef.once('value').then(function (snapshot) {
					if (snapshot.val() == null) document.getElementById('nameInp').setAttribute('value', "");
					document.getElementById('nameInp').setAttribute('value', snapshot.val());
					
				});
			} else {
				document.getElementById('sign-in').textContent = '{{site.sign_in_message}}';
				document.getElementById('aff').style.visibility = "hidden";
				document.getElementById('link').style.visibility = "hidden";
				document.getElementById('name').style.visibility = "hidden";
				document.getElementById('email').style.visibility = "hidden";
			}
				document.getElementById('sign-in').disabled = false;
		});
	  document.getElementById('sign-in').addEventListener('click', toggleSignIn, false);
	}
	window.onload = function() {
	  initApp();
	};
	function getInfo() {
	  if (firebase.auth().currentUser){
		if (document.getElementById('affliation').value.length > 0) {
			var user = firebase.auth().currentUser;
			var affliation = document.getElementById('affliation').value;
			var name = document.getElementById('nameInp').value;
			var affliationRef = firebase.database().ref('users/' + user.uid+ '/affliation');

			affliationRef.once('value').then(function(snapshot) {
				if (snapshot.val() == null) {
					writeUserInfo(user, affliation); 
					document.getElementById('button').textContent = 'Change';
					document.getElementById('link').style.visibility = "visible";
				} else {
					updateUsetInfo(user, affliation, name);
				}
			 });
			console.log(document.getElementById('affliation').value);
			alert('Your information has been saved.')
		} else {
			alert('Please Senter affliation');
		};
	  } else {
			alert('Please log in');
	  }
	}
	function writeUserInfo(user, affliation) {
		if (user.displayName == null) displayName = "";
		firebase.database().ref('users/' + user.uid).set({
			username: displayName,
			email: user.email,
			affliation: affliation,
			numlinkclick: 0
		});
	}
	function updateUsetInfo(user, affliation, name) {
		firebase.database().ref('users/' + user.uid+ '/affliation').transaction(function (snapshot) {
			return affliation;
		});
		firebase.database().ref('users/' + user.uid+ '/username').transaction(function (snapshot) {
			return name;
		});
	}
	function linkClick() {
		var userID = firebase.auth().currentUser.uid;
		var numlinkclickRef = firebase.database().ref('users/' + userID+ '/numlinkclick');
		numlinkclickRef.transaction(function (snapshot) {
			return snapshot + 1;
		});

	}
	var input = document.getElementById("affliation");
		input.addEventListener("keyup", function(event) {
			event.preventDefault();
			if (event.keyCode === 13) {
				document.getElementById("button").click();
			}
	});
  </script>
<script type="application/ld+json">
{"name":"{{site.title}}","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","@type":"WebSite","url":"https://iolfcv.github.io","headline":"Your awesome title","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

	<link rel="stylesheet" href="/assets/css/style.css?v=">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css"> -->
	<!--[if lt IE 9]>
	<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
	<![endif]-->
  </head>
  <body>
	<div class="wrapper">
	  <header>
		<h1><a href="https://iolfcv.github.io">{{site.title}}</a></h1>



		<img src="/assets/img/logo.png" alt="Logo" />







	  </header>
	  <section>
					<!-- <p>Sign in with your GitHub account below.</p> -->
				<div class="w3-container" id="container">
					<!-- Button that handles sign-in/sign-out -->
					<div class="w3-container w3-padding-large"><button class="w3-button w3-black w3-large w3-margin-top w3-opacity w3-hover-opacity-off" id="sign-in">{{site.sign_in_message}}</button></div>
				  
					<div class="w3-panel w3-padding-large">
						<div class="w3-container w3-padding-large w3-border" id="aff">
							<div class="w3-padding-large" id="name">
									Name:
									<input type="text" id="nameInp" name="name" value="">
							</div>
							<div class="w3-padding-large" id="email">
									Email:
									<input type="text" id="emailInp" name="name" value="" disabled>
							</div>
							<div class="w3-padding-large">
									{{site.aff}}:
									<input type="text" id="affliation" name="affliation" value=""></div>
							<div class="w3-padding-large"><button class="w3-opacity w3-black w3-hover-opacity-off" onclick="getInfo()" id="button">Submit</button></div>
						</div>
					</div>
				  <div class="downloads w3-container w3-padding-large">
					  <button class="w3-opacity w3-black w3-hover-opacity-off" id="link" onclick="linkClick()">Download</button>
				  </div>
			</div>

	  </section>
	  <footer>

		<p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
	  </footer>
	</div>

	<script src="/assets/js/scale.fix.js"></script>

  </body>
</html>
